# Storylister Backend Core (no UI)

This package is **backend-only**. It keeps your existing **front-end UI exactly as-is** and provides a stable core that:
- Injects a page-world interceptor to observe Instagram's own responses (no direct API calls)
- Opens the **Seen by** dialog and gently scrolls to trigger Instagram pagination
- Normalizes viewer chunks and stores them in **IndexedDB** (24h retention; last 3 stories kept)
- Exposes a small API and events your UI can subscribe to

## Files

- `manifest.json` — loads the backend on `instagram.com`
- `content-backend.js` — the core logic (no DOM changes to your UI)
- `injected.js` — page-world fetch/XHR interceptor

## Load for testing

1. Go to `chrome://extensions`, toggle **Developer mode**.
2. **Load unpacked** and select this folder.
3. Open your own story on Instagram and click **Seen by** (the core will also try to click it for you).
4. Your current UI can subscribe to updates (see below).

## How your existing UI can subscribe

```js
// Get a snapshot:
const state = window.StorylisterCore.getState(); // {storyId, total, newCount, viewers: [...]}

// Subscribe to updates:
window.StorylisterCore.onUpdate((state) => {
  // Re-render your existing DOM from `state.viewers`
});

// Listen to the 10s auto-scroll pause (to show "Continue" in your UI)
window.StorylisterCore.onPause(() => {
  // show your "Continue" affordance and call startAutoScroll again if the user accepts
});
```

### Drive actions from your UI

```js
// Ensure "Seen by" dialog is open:
window.StorylisterCore.openViewers();

// Start/stop auto-scroll (e.g., when user clicks "Continue"):
window.StorylisterCore.startAutoScroll(10000); // 10s
window.StorylisterCore.stopAutoScroll();

// Mark everything currently visible as "seen" (so NEW badges drop next time)
window.StorylisterCore.markCurrentAsSeen();
```

## Notes

- We **do not** issue our own requests to IG. Auto-pagination is achieved by scrolling the viewer modal (safer, avoids 403s).
- Viewers are deduplicated by `id` and stamped with `viewedAt` in arrival order so "Newest" sort is stable.
- Retention: 24h for free, last 3 stories kept. Increase in a Pro build by adjusting `CONFIG` in `content-backend.js`.
- All data is local (IndexedDB + localStorage). No server storage.
